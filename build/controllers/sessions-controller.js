"use strict";var p=Object.defineProperty;var E=Object.getOwnPropertyDescriptor;var j=Object.getOwnPropertyNames;var C=Object.prototype.hasOwnProperty;var T=(r,s)=>{for(var e in s)p(r,e,{get:s[e],enumerable:!0})},y=(r,s,e,i)=>{if(s&&typeof s=="object"||typeof s=="function")for(let o of j(s))!C.call(r,o)&&o!==e&&p(r,o,{get:()=>s[o],enumerable:!(i=E(s,o))||i.enumerable});return r};var I=r=>y(p({},"__esModule",{value:!0}),r);var S={};T(S,{SessionsController:()=>c});module.exports=I(S);var n=class{message;statusCode;constructor(s,e=400){this.message=s,this.statusCode=e}};var a=require("zod"),P=a.z.object({DATABASE_URL:a.z.string().url(),JWT_SECRET:a.z.string(),PORT:a.z.coerce.number().default(3333)}),d=P.parse(process.env);var u={jwt:{secret:d.JWT_SECRET,expiresIn:"1d"}};var w=require("@prisma/client"),f=new w.PrismaClient({log:process.env.NODE_ENV==="production"?[]:["query"]});var h=require("jsonwebtoken"),l=require("bcrypt"),m=require("zod"),c=class{async create(s,e){let i=m.z.object({email:m.z.string().email(),password:m.z.string().min(6)}),{email:o,password:g}=i.parse(s.body),t=await f.user.findFirst({where:{email:o}});if(!t)throw new n("Invalid email or password",401);if(!await(0,l.compare)(g,t.password))throw new n("Invalid email or password",401);let{secret:b,expiresIn:R}=u.jwt,v=(0,h.sign)({role:t.role??"customer"},b,{subject:t.id,expiresIn:R}),{password:q,...x}=t;return e.json({token:v,user:x})}};0&&(module.exports={SessionsController});
//# sourceMappingURL=sessions-controller.js.map