"use strict";var h=Object.defineProperty;var j=Object.getOwnPropertyDescriptor;var C=Object.getOwnPropertyNames;var q=Object.prototype.hasOwnProperty;var z=(t,e)=>{for(var r in e)h(t,r,{get:e[r],enumerable:!0})},A=(t,e,r,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of C(e))!q.call(t,s)&&s!==r&&h(t,s,{get:()=>e[s],enumerable:!(o=j(e,s))||o.enumerable});return t};var E=t=>A(h({},"__esModule",{value:!0}),t);var N={};z(N,{deliveriesRoutes:()=>c});module.exports=E(N);var b=require("express");var R=require("@prisma/client"),a=new R.PrismaClient({log:process.env.NODE_ENV==="production"?[]:["query"]});var d=require("zod"),f=class{async create(e,r){let o=d.z.object({user_id:d.z.string().uuid(),description:d.z.string()}),{user_id:s,description:i}=o.parse(e.body);return await a.delivery.create({data:{userId:s,description:i}}),r.status(201).json()}async index(e,r){let o=await a.delivery.findMany({include:{user:{select:{name:!0,email:!0}}}});return r.json(o)}};var u=require("zod"),l=class{async update(e,r){let o=u.z.object({id:u.z.string().uuid()}),s=u.z.object({status:u.z.enum(["processing","shipped","delivered"])}),{id:i}=o.parse(e.params),{status:m}=s.parse(e.body);return await a.delivery.update({data:{status:m},where:{id:i}}),await a.deliveryLog.create({data:{deliveryId:i,description:m}}),r.json()}};var g=require("jsonwebtoken");var p=require("zod"),S=p.z.object({DATABASE_URL:p.z.string().url(),JWT_SECRET:p.z.string(),PORT:p.z.coerce.number().default(3333)}),y=S.parse(process.env);var v={jwt:{secret:y.JWT_SECRET,expiresIn:"1d"}};var n=class{message;statusCode;constructor(e,r=400){this.message=e,this.statusCode=r}};function w(t,e,r){try{let o=t.headers.authorization;if(!o)throw new n("JWT token not found",401);let[,s]=o.split(" "),{role:i,sub:m}=(0,g.verify)(s,v.jwt.secret);return t.user={id:m,role:i},r()}catch{throw new n("Invalid JWT token",401)}}function x(t){return(e,r,o)=>{if(!e.user)throw new n("Unauthorized",401);if(!t.includes(e.user.role))throw new n("Unauthorized",401);return o()}}var c=(0,b.Router)(),T=new f,_=new l;c.use(w,x(["sale"]));c.post("/",T.create);c.get("/",T.index);c.patch("/:id/status",_.update);0&&(module.exports={deliveriesRoutes});
//# sourceMappingURL=deliveries-routes.js.map