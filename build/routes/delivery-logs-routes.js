"use strict";var m=Object.defineProperty;var b=Object.getOwnPropertyDescriptor;var T=Object.getOwnPropertyNames;var _=Object.prototype.hasOwnProperty;var A=(r,e)=>{for(var t in e)m(r,t,{get:e[t],enumerable:!0})},E=(r,e,t,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of T(e))!_.call(r,i)&&i!==t&&m(r,i,{get:()=>e[i],enumerable:!(s=b(e,i))||s.enumerable});return r};var C=r=>E(m({},"__esModule",{value:!0}),r);var z={};A(z,{deliveryLogsRoutes:()=>h});module.exports=C(z);var R=require("express");var o=class{message;statusCode;constructor(e,t=400){this.message=e,this.statusCode=t}};var w=require("@prisma/client"),c=new w.PrismaClient({log:process.env.NODE_ENV==="production"?[]:["query"]});var u=require("zod"),p=class{async create(e,t){let s=u.z.object({delivery_id:u.z.string().uuid(),description:u.z.string()}),{delivery_id:i,description:n}=s.parse(e.body),a=await c.delivery.findUnique({where:{id:i}});if(!a)throw new o("delivery not found",404);if(a.status==="delivered")throw new o("this order has already been delivered");if(a.status==="processing")throw new o("change status to shipped");return await c.deliveryLog.create({data:{deliveryId:i,description:n}}),t.status(201).json()}async show(e,t){let s=u.z.object({delivery_id:u.z.string().uuid()}),{delivery_id:i}=s.parse(e.params),n=await c.delivery.findUnique({where:{id:i},include:{user:!0,logs:!0}});if(e.user?.role==="customer"&&e.user.id!==n?.userId)throw new o("the user can only view their deliveries",401);return t.json(n)}};var g=require("jsonwebtoken");var d=require("zod"),j=d.z.object({DATABASE_URL:d.z.string().url(),JWT_SECRET:d.z.string(),PORT:d.z.coerce.number().default(3333)}),v=j.parse(process.env);var y={jwt:{secret:v.JWT_SECRET,expiresIn:"1d"}};function l(r,e,t){try{let s=r.headers.authorization;if(!s)throw new o("JWT token not found",401);let[,i]=s.split(" "),{role:n,sub:a}=(0,g.verify)(i,y.jwt.secret);return r.user={id:a,role:n},t()}catch{throw new o("Invalid JWT token",401)}}function f(r){return(e,t,s)=>{if(!e.user)throw new o("Unauthorized",401);if(!r.includes(e.user.role))throw new o("Unauthorized",401);return s()}}var h=(0,R.Router)(),x=new p;h.post("/",l,f(["sale"]),x.create);h.get("/:delivery_id/show",l,f(["sale","customer"]),x.show);0&&(module.exports={deliveryLogsRoutes});
//# sourceMappingURL=delivery-logs-routes.js.map