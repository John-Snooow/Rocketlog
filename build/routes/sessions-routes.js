"use strict";var c=Object.defineProperty;var j=Object.getOwnPropertyDescriptor;var T=Object.getOwnPropertyNames;var S=Object.prototype.hasOwnProperty;var y=(o,s)=>{for(var r in s)c(o,r,{get:s[r],enumerable:!0})},I=(o,s,r,a)=>{if(s&&typeof s=="object"||typeof s=="function")for(let e of T(s))!S.call(o,e)&&e!==r&&c(o,e,{get:()=>s[e],enumerable:!(a=j(s,e))||a.enumerable});return o};var P=o=>I(c({},"__esModule",{value:!0}),o);var A={};y(A,{sessionsRoutes:()=>R});module.exports=P(A);var g=require("express");var n=class{message;statusCode;constructor(s,r=400){this.message=s,this.statusCode=r}};var i=require("zod"),_=i.z.object({DATABASE_URL:i.z.string().url(),JWT_SECRET:i.z.string(),PORT:i.z.coerce.number().default(3333)}),d=_.parse(process.env);var u={jwt:{secret:d.JWT_SECRET,expiresIn:"1d"}};var w=require("@prisma/client"),f=new w.PrismaClient({log:process.env.NODE_ENV==="production"?[]:["query"]});var l=require("jsonwebtoken"),h=require("bcrypt"),m=require("zod"),p=class{async create(s,r){let a=m.z.object({email:m.z.string().email(),password:m.z.string().min(6)}),{email:e,password:b}=a.parse(s.body),t=await f.user.findFirst({where:{email:e}});if(!t)throw new n("Invalid email or password",401);if(!await(0,h.compare)(b,t.password))throw new n("Invalid email or password",401);let{secret:x,expiresIn:C}=u.jwt,v=(0,l.sign)({role:t.role??"customer"},x,{subject:t.id,expiresIn:C}),{password:z,...E}=t;return r.json({token:v,user:E})}};var R=(0,g.Router)(),q=new p;R.post("/",q.create);0&&(module.exports={sessionsRoutes});
//# sourceMappingURL=sessions-routes.js.map